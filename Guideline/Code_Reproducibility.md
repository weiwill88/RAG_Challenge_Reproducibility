# RAG Challenge 获胜方案复现指南

## 复现目标和重点

### 核心目标
1. **验证获胜方案的技术创新点** - 特别是LLM重排序、"一文一库"设计、查询路由等核心技术
2. **学习企业级RAG系统的工程化实践** - 从PDF解析到最终生成的完整流水线
3. **理解比赛场景下的优化策略** - 如何在严格约束下(时间、格式、引用)达到最佳效果

### 技术创新验证重点

#### 1. 核心技术创新
- **LLM重排序机制**：验证0.7×LLM + 0.3×embed的加权效果
- **"一文一库"架构**：理解为什么单独建索引比混合索引效果更好  
- **父页面检索策略**：chunk定位+完整页面上下文的设计思路

#### 2. 工程化最佳实践
- **模块化提示词管理**：prompts.py的组织方式和复用机制
- **结构化输出+Reparser**：保证100%合规输出的技术方案
- **多层路由设计**：数据库路由+提示词路由+复合查询处理

#### 3. 性能优化策略
- **解析速度优化**：Docling定制化+GPU加速
- **并发处理设计**：25题批量处理机制
- **成本控制平衡**：轻量模型重排vs重型模型生成

## 复现任务列表

### 阶段1：环境搭建和依赖安装 ✅
- [x] 配置Python环境
- [x] 安装requirements.txt
- [x] 设置API密钥（Gemini + GTE-Rerank-v2）
- [ ] 验证环境配置正确性

### 阶段2：数据准备和验证
- [x] 确认`data/test_set/pdf_reports`中的5个原始PDF报告已就绪
- [ ] **复现说明**: 我们将忽略`databases`和`debug_data`中预处理好的数据，从原始PDF开始，逐步生成所有中间文件，以完整复现整个流水线。

### 阶段3：PDF解析阶段复现
**重点验证**：
- [ ] **任务**: 从`data/test_set/pdf_reports`中的原始PDF开始，运行PDF解析流水线
- [ ] 理解Docling定制化改进
- [ ] 测试PDF解析效果和速度
- [ ] 分析表格序列化技术（虽然最终未使用）
- [ ] 验证文本清理和预处理效果
- [ ] 分析向量化和存储机制

### 阶段4：数据注入阶段复现
**重点学习**：
- [ ] 验证300token+50overlap的切块策略
- [ ] 理解FAISS IndexFlatIP的选择逻辑
- [ ] 测试"一文一库"vs"大杂烩"的效果对比

### 阶段5：检索阶段复现
**核心重点**：
- [ ] **任务**: 基于生成的数据库，复现检索与重排序流程
- [ ] 实现LLM重排序机制（使用Gemini-2.5-flash）
- [ ] 验证GTE-Rerank-v2的重排效果
- [ ] 测试父页面检索的精度提升
- [ ] 分析Top-30→Top-10的筛选机制
- [ ] 对比不同重排序策略的效果
- [ ] 分析查询路由的实现方式

### 阶段6：生成阶段复现
**关键技术**：
- [ ] 理解4套提示词的切换逻辑
- [ ] 验证CoT+结构化输出的配合机制
- [ ] 测试Reparser的容错处理

### 阶段7：完整流水线集成测试
- [ ] **任务**: 将所有生成的组件串联起来，进行端到端测试
- [ ] 验证各组件协同工作
- [ ] 测试异常处理和容错机制

### 阶段8：性能分析和优化验证
- [ ] 测试不同配置效果对比
- [ ] 分析关键技术创新点的实际效果
- [ ] 验证成本控制和性能平衡策略
- [ ] 记录性能指标和优化建议

### 阶段9：复现总结文档撰写
- [ ] 整理复现过程和技术要点
- [ ] 总结学习心得和工程化经验
- [ ] 分析适用场景和改进建议
- [ ] 编写完整的复现报告

## 复现操作记录

详细的、可执行的操作步骤、命令和终端输出已被迁移至独立的日志文件。这有助于将高层级的复现计划与底层的执行细节分离，使两个文档都更加清晰。

**[👉 点击此处查看详细操作日记 (Operational_Diary.md)](./Operational_Diary.md)**

## 重点验证问题

### 技术创新深入理解
1. **为什么LLM重排序比传统方法更有效？**
2. **"一文一库"设计的业务场景适应性如何？**
3. **结构化输出在保证合规性方面的实际效果？**
4. **多层路由策略如何提升系统整体性能？**

### 工程化经验总结
1. **模块化设计在复杂RAG系统中的价值**
2. **多层路由策略的通用性和扩展性**
3. **成本控制和性能平衡的权衡策略**
4. **企业级部署的考虑因素**

## 模型替换配置

### 当前配置
- **LLM模型**：Gemini-1.5-flash（500次/天免费，10次/分钟限制）
- **重排序模型**：Jina Reranker v2（阿里云百炼）
- **嵌入模型**：待确认（可能需要替换为兼容方案）

### 需要注意的限制
1. **Gemini速率限制**：每分钟10次请求，需要调整并发策略
2. **成本控制**：合理使用免费额度

## 预期成果

### 技术验证结果
- 各个创新点的实际效果验证数据
- 不同配置的性能对比分析
- 关键技术的适用场景分析

### 工程化心得
- 企业级RAG系统的设计原则
- 模块化架构的最佳实践
- 成本控制和性能优化策略

### 改进建议
- 基于复现过程发现的优化方向
- 不同业务场景的适配建议
- 技术栈替换的经验总结
